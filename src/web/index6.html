<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Belgian Trains â€“ Real Rail Geometry</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map { height: 100vh; }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([51.18, 3.42], 10);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 18
}).addTo(map);

let corridorLayer = null;
let trainMarkers = {};

// Load real rail corridor
fetch('http://127.0.0.1:8000/rail_corridor')
  .then(r => r.json())
  .then(geojson => {
    corridorLayer = L.geoJSON(geojson, {
      style: {
        color: 'black',
        weight: 2
      }
    }).addTo(map);

    map.fitBounds(corridorLayer.getBounds());
  });

// Load train positions
async function updateTrains() {
  const res = await fetch('http://127.0.0.1:8000/active_trains');
  const trains = await res.json();

  trains.forEach(t => {
    const key = t.train_id;
    const latlng = [t.lat, t.lon];

    if (!trainMarkers[key]) {
      trainMarkers[key] = L.circleMarker(latlng, {
        radius: 6,
        color: 'green',
        fillOpacity: 0.8
      }).addTo(map);
    } else {
      trainMarkers[key].setLatLng(latlng);
    }
  });
}

updateTrains();
setInterval(updateTrains, 5000);
</script>

</body>
</html>
